# Техническое задание: Брендирование в корзине

## 1. Доступность брендирования
- Кнопка "Добавить брендирование" активна только при наличии доступных комбинаций тип-место
- Доступность проверяется через `isAnyBrandingAvailable`
- Состояние кнопки обновляется при:
  - Загрузке страницы корзины
  - После добавления брендирования
  - После удаления брендирования

## 2. Отображение цен
- Цены отображаются в трех местах:
  - В строке брендирования (цена и стоимость)
  - В общей сумме брендирования для товара
  - В summary корзины (общая сумма брендирования всех товаров)
- Все места отображения цен синхронизированы
- Обновление происходит при любом изменении (количества товара, удалении брендирования)

## 3. Обработка ошибок
- При отсутствии opportunities или неверном формате - кнопка добавления неактивна
- При отсутствии всех цен - показ ошибки пользователю, брендирование не создается
- При отсутствии цены для конкретного количества - использование цены ближайшего меньшего количества

## 4. Алгоритм поиска цены
```javascript
function findBrandingPrice(opportunities, targetQuantity) {
    // Точное совпадение по количеству
    const exactMatch = pricePoints.find(p => p.quantity === targetQuantity);
    if (exactMatch) return exactMatch.price;
    
    // Ближайшее меньшее количество
    const lowerQuantity = pricePoints
        .filter(p => p.quantity < targetQuantity)
        .sort((a, b) => b.quantity - a.quantity)[0];
    if (lowerQuantity) return lowerQuantity.price;
    
    // Минимальное большее количество
    const higherQuantity = pricePoints
        .filter(p => p.quantity > targetQuantity)
        .sort((a, b) => a.quantity - b.quantity)[0];
    if (higherQuantity) return higherQuantity.price;
    
    throw new Error('No prices available for branding');
}
```

## 5. Интерфейс добавления брендирования
1. Кнопка "Добавить брендирование"
2. Диалог с последовательным выбором:
   - Тип печати (только типы с доступными местами)
   - Место печати (доступные для выбранного типа)
   - Количество цветов
   - Второй проход (да/нет)

## 6. Валидация
- Предварительная фильтрация доступных опций в UI
- Показ только доступных вариантов в выпадающих списках
- Дополнительная валидация не требуется

## 7. Обновление UI
При изменении количества товара:
- Пересчет базовой цены брендирования
- Пересчет цены брендирования (с учетом цветов и второго прохода)
- Пересчет стоимости брендирования (с учетом количества)
- Обновление всех мест отображения цен

При добавлении/удалении брендирования:
- Пересчет доступности типов и мест
- Обновление состояния кнопки
- Обновление отображения цен

## 8. Структура данных
```javascript
{
  branding: [
    {
      print_type_id: number,    // ID типа печати
      print_place_id: number,   // ID места печати
      color_count: number,      // Количество цветов
      second_pass: boolean,     // Второй проход
      price: number,            // Цена брендирования
      cost: number              // Стоимость брендирования
    }
  ]
}
```

## 9. Ограничения
- Нет возможности редактирования существующего брендирования
- Только удаление и добавление нового брендирования
- Упрощает логику проверки доступности 