(()=>{"use strict";var e,t,n,c,o={342:(e,t,n)=>{n.a(e,(async(e,t)=>{try{var c=n(812);await(0,c.R)(),t()}catch(e){t(e)}}),1)},812:(e,t,n)=>{function c(e,t,n){const c=e.closest(".product").querySelector(`div.product-hor__image-frame[data-id="${n}"]`);e.closest(".color-padding").querySelector(`input[id="${e.htmlFor}"]`).checked=!0;const o=c.querySelector("img");if(c!==t){o.complete?(c.classList.remove("item-hidden"),setTimeout((()=>{c.classList.remove("item-opaque")}),1),t.classList.add("item-opaque"),setTimeout((()=>{t.classList.add("item-hidden")}),400)):(o.removeAttribute("loading"),o.addEventListener("load",(()=>{c.classList.remove("item-hidden"),setTimeout((()=>{c.classList.remove("item-opaque")}),1),t.classList.add("item-opaque"),setTimeout((()=>{t.classList.add("item-hidden")}),400)})));const n=c.dataset.article,i=c.dataset.price,r=c.dataset.description,a=e.closest(".product");a.querySelector(".product-hor__color-description").textContent=r,a.querySelector(".price").textContent=i,a.querySelector(".article").textContent=n}}function o(e){const t=this.querySelector(".color-label__check"),n=[...this.closest(".product").querySelectorAll("div.product-hor__image-frame")].find((e=>!e.classList.contains("item-hidden")));if(""===t.style.display){const t=e.target.closest(".color-padding");[...t.querySelectorAll("div.color-label__check")].forEach((e=>{e.removeAttribute("style")})),t.querySelector(`div.color-label__check[data-id="${e.target.dataset.id}"]`).style.display="block",c(this,n,e.target.dataset.id)}}function i(e){const t=e.target.closest(".tab-btn-block"),n=t.closest(".product-frame").querySelector(".tab-content").querySelectorAll(".tab"),c=[...n].find((t=>t.dataset.id===e.target.dataset.id));t.querySelectorAll(".tab-btn").forEach((e=>{e.classList.remove("tab-active")})),e.target.classList.add("tab-active"),n.forEach((e=>{e.classList.remove("tab-show")})),c.classList.add("tab-show")}function r(e){const t=JSON.parse(this.dataset.list),n=[...this.closest(".product-frame").querySelectorAll("div.product-hor__image-frame")].find((e=>!e.classList.contains("item-hidden"))),o=t.indexOf(t.find((e=>e.toString()===n.dataset.id))),i=o===t.length-1?t[0]:t[o+1],r=this.closest(".product").querySelector(`label.color-label[data-id="${i}"]`);[...r.closest(".color-padding").querySelectorAll("div.color-label__check")].forEach((e=>{e.removeAttribute("style")})),r.querySelector(".color-label__check").setAttribute("style","display: block;"),t.length>1&&c(r,n,i)}function a(e){const t=e.target.value;e.target.nextElementSibling.textContent="до "+t}function s(e){const t=document.querySelectorAll('.filter input[type="checkbox"]'),n=document.querySelectorAll(".filter__content_data_color .color-label__check"),c=document.querySelector(".filter"),o=document.querySelector(".filter .input-range"),i=document.querySelector(".filter .input-range__value");t.forEach((e=>{e.checked=!1})),n.forEach((e=>{e.removeAttribute("style")})),o.value=o.max,i.textContent="до "+o.max,c.removeAttribute("open"),[...document.querySelectorAll(".product")].forEach((e=>{e.removeAttribute("style");const t=e.querySelectorAll(".product-hor__image-frame"),n=[...t].map((e=>parseInt(e.dataset.id))),c=Math.round(Math.random()*(t.length-1));e.querySelector(".chev-next").dataset.list=e.querySelector(".chev-next").dataset.listInitial,[...t].forEach(((e,t)=>{e.removeAttribute("style")})),e.querySelector(`.color-padding label.color-label[data-id="${n[c]}"]`).click()})),[...document.querySelectorAll(".products .color-label")].forEach((e=>{e.removeAttribute("style")}));const r=document.querySelector(".filter-badge");r.removeAttribute("style"),r.textContent=""}async function l(e){e.preventDefault();const t="/filter",n=[...document.querySelectorAll(".product")].reduce(((e,t)=>(e[t.getAttribute("data-id")]=t,e)),{}),c=document.querySelectorAll(".product-hor__image-frame"),o=[...c].reduce(((e,t)=>(e[t.getAttribute("data-id")]=t,e)),{});let i,r,a,s;const l=document.querySelector(".filter"),p=d(l.querySelectorAll('.filter__content_data_filter input[type="checkbox"]'));p.length>0&&(i=await m(u(p),Object.keys(n),t,"filter"));const _=d(l.querySelectorAll('.filter__content_data_print input[type="checkbox"]'));_.length>0&&(r=await m(u(_),Object.keys(n),t,"print"));const y=d(l.querySelectorAll('.filter__content_data_color input[type="checkbox"]'));y.length>0&&(a=await m(u(y),Object.keys(o),t,"color"));const v=l.querySelector(".filter .input-range");v.value<=v.max-.1&&(s=function(e,t){const n=[],c=[];return[...t].forEach((t=>{parseFloat(t.dataset.price)<=parseFloat(e)&&(c.push(t.dataset.id),n.includes(t.dataset.goods)||n.push(t.dataset.goods))})),{goods:n,item:c}}(v.value,c)),function(e,t,n,c,o,i,r){let a,s,l,d,u,m;const p=[],_=[];a=e||Object.keys(o),s=t||Object.keys(o),l=n?n.goods:Object.keys(o),u=n&&n.item?n.item:Object.keys(r),d=c?c.goods:Object.keys(o),m=c&&c.item?c.item:Object.keys(r),Object.keys(o).forEach((e=>{a.includes(e)&&s.includes(e)&&l.includes(e)&&d.includes(e)?(o[e].removeAttribute("style"),p.push(o[e])):o[e].setAttribute("style","display:none")})),(n||c)&&(Object.keys(r).forEach((e=>{u.includes(e)&&m.includes(e)?(r[e].removeAttribute("style"),_.push(r[e])):r[e].setAttribute("style","display:none")})),[...document.querySelectorAll(".products .color-label")].forEach((e=>{e.removeAttribute("style"),u.includes(e.dataset.id)&&m.includes(e.dataset.id)||e.setAttribute("style","display:none")})),p.forEach((e=>{const t=[...[...e.querySelectorAll(".product-hor__image-frame")].filter((e=>_.includes(e)))].map((e=>parseInt(e.dataset.id)));e.querySelector(".chev-next").dataset.list=JSON.stringify(t);const n=t.length>1?Math.round(Math.random()*(t.length-1)):0;e.querySelector(`.color-padding label.color-label[data-id="${t[n]}"]`).click()})))}(i,r,a,s,n,0,o),document.querySelector(".filter").removeAttribute("open")}function d(e){return[...e].filter((e=>e.checked))}function u(e){return[...e].map((e=>e.getAttribute("data-id")))}async function m(e,t,n,c){const o=n+"/"+c,i=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({goods_id:t,filter_id:e})});return(await i.json()).idList}function p(e,t){let n=[...e].filter((e=>e.checked)).length;t.value<t.max-.1&&n++;const c=document.querySelector(".filter-badge");n?(c.textContent=n,c.style.display="block"):(c.removeAttribute("style"),c.textContent="")}function _(e){let t,n,c;const o=e.target.closest(".product"),i=e.target.closest(".product-frame"),r=i.dataset.id,a=JSON.parse(o.dataset.articleSet),s=document.createElement("dialog");s.classList.add("simple-constructor");const l=document.createElement("form");l.id="constructor",l.classList.add("simple-constructor__items"),s.appendChild(l),a.forEach((e=>{c=document.createElement("div"),l.appendChild(c),n=document.createElement("h4"),c.appendChild(n),t=document.createElement("div"),c.appendChild(t),Object.keys(e).includes("option")?(n.textContent="опция",t.classList.add("simple-constructor__option"),function(e,t,n){e.option.forEach((e=>{const c=document.createElement("div");c.classList.add("simple-constructor__option_element"),t.appendChild(c);const o=document.createElement("input");o.type="radio",o.name="option",o.id=e.option_article,o.value=e.option_article,c.appendChild(o);const i=document.createElement("label");i.textContent=e.name,i.htmlFor=e.option_article,c.appendChild(i),o.addEventListener("change",(e=>{n.querySelector(".simple-constructor__alert").textContent=""}))}))}(e,t,s)):(n.textContent=e.parts_description__name,t.classList.add("simple-constructor__color"),function(e,t,n,c){e.color.forEach((o=>{const i=document.createElement("input");i.type="radio",i.name=e.position,i.id=o.name+o.code+e.position+"_"+n,i.value=o.code,i.hidden=!0,t.appendChild(i);const r=document.createElement("div");r.classList.add("simple-constructor__square_frame");const a=document.createElement("label");a.classList.add("simple-constructor__square","tooltip"),a.style.backgroundColor=o.hex,a.htmlFor=o.name+o.code+e.position+"_"+n;const s=document.createElement("div");s.classList.add("tooltip-text"),s.textContent=o.name,a.appendChild(s),r.appendChild(a),t.appendChild(r),i.addEventListener("change",(e=>{c.querySelector(".simple-constructor__alert").textContent="",[...t.querySelectorAll(".simple-constructor__square_frame")].forEach((e=>{e.style.visibility="hidden"})),r.style.visibility="visible"}))}))}(e,t,r,s))}));const d=document.createElement("div");d.classList.add("simple-constructor__footer");const u=document.createElement("div");u.classList.add("simple-constructor__alert"),d.appendChild(u);const m=document.createElement("div");m.classList.add("btn-block"),d.appendChild(m),s.appendChild(d);const p=document.createElement("button");p.classList.add("btn","btn__save"),p.textContent="Применить",p.addEventListener("click",(()=>{!function(e,t,n){const c=e.querySelector("form"),o=new FormData(c),i=Object.fromEntries(o.entries()),r=parseInt(t.dataset.articleLength),a=Object.keys(i).includes("option")?Object.keys(i).length-1:Object.keys(i).length;if(a===r){let c=t.dataset.goodsArticle;for(let e=1;e<=a;e++)c=c+"."+i[e];i.option&&(c=c+"."+i.option);const o=t.querySelector(`div.product-frame[data-article="${c}"]`);o?(n.classList.add("item-hidden","item-opaque"),o.classList.remove("item-hidden","item-opaque"),e.remove()):e.querySelector(".simple-constructor__alert").textContent="Для заказа этого товара обратитесь к менеджеру. Цена: "+n.dataset.price}else e.querySelector(".simple-constructor__alert").textContent="Отметьте все элементы";console.log()}(s,o,i)}));const _=document.createElement("button");_.classList.add("btn","btn__cancel"),_.textContent="Закрыть",_.addEventListener("click",(()=>{!function(e){e.close(),e.remove()}(s)})),m.appendChild(_),m.appendChild(p),document.body.appendChild(s),s.showModal()}n.d(t,{R:()=>h});const y={showAddToCartModal:function(e,t){let n=document.getElementById("addToCartModal");n||(n=this._createModal(),document.body.appendChild(n),this._setupModalEvents(n));const c=document.getElementById("modalProductName"),o=document.getElementById("modalArticle"),i=document.getElementById("modalColor");c&&(c.textContent=e.name||""),o&&(o.textContent=e.article||""),i&&(i.textContent=e.color||""),n.classList.add("active");const r=document.getElementById("modalConfirmBtn");if(r){const c=r.cloneNode(!0);r.parentNode.replaceChild(c,r),c.addEventListener("click",(()=>{n.classList.remove("active"),"function"==typeof t&&t(e)}))}},showSuccessNotification:function(e){let t=document.getElementById("successNotification");t||(t=this._createNotification(),document.body.appendChild(t),this._setupNotificationEvents(t));const n=document.getElementById("successMessage");n&&(n.textContent=e||"Товар успешно добавлен в корзину"),t.classList.add("active"),setTimeout((()=>{t.classList.remove("active")}),3e3)},_createModal:function(){const e=document.createElement("div");return e.className="add-to-cart-modal",e.id="addToCartModal",e.innerHTML='\n            <div class="add-to-cart-modal__content">\n                <div class="add-to-cart-modal__header">\n                    <i class="fa-solid fa-cart-shopping"></i>\n                    <h3>Добавление в корзину</h3>\n                </div>\n                <div class="add-to-cart-modal__message" id="modalMessage">\n                    Товар "<strong id="modalProductName"></strong>" (<span id="modalArticle"></span>), цвет: <span id="modalColor"></span> будет добавлен в корзину.\n                </div>\n                <div class="add-to-cart-modal__actions">\n                    <button class="btn btn__cancel" id="modalCancelBtn">Отмена</button>\n                    <button class="btn btn__save" id="modalConfirmBtn">Добавить</button>\n                </div>\n            </div>\n        ',e},_createNotification:function(){const e=document.createElement("div");return e.className="success-notification",e.id="successNotification",e.innerHTML='\n            <div class="success-notification__icon">\n                <i class="fa-solid fa-circle-check"></i>\n            </div>\n            <div class="success-notification__content">\n                <h4 class="success-notification__title">Товар добавлен в корзину</h4>\n                <p class="success-notification__message" id="successMessage">Товар успешно добавлен в корзину</p>\n            </div>\n            <button class="success-notification__close" id="notificationCloseBtn">\n                <i class="fa-solid fa-xmark"></i>\n            </button>\n        ',e},_setupModalEvents:function(e){const t=document.getElementById("modalCancelBtn");t&&t.addEventListener("click",(()=>{e.classList.remove("active")})),e.addEventListener("click",(t=>{t.target===e&&e.classList.remove("active")}))},_setupNotificationEvents:function(e){const t=document.getElementById("notificationCloseBtn");t&&t.addEventListener("click",(()=>{e.classList.remove("active")}))}};class v{static init(){const e=document.querySelector(".recently-viewed__items");if(!e)return;e.innerHTML="";const t=this.getRecentlyViewedProducts();t&&t.length>0&&(t.forEach((t=>{const n=this.createProductElement(JSON.parse(t.data));e.appendChild(n)})),this.initEventListeners())}static getRecentlyViewedProducts(){try{const e=localStorage.getItem("recentlyViewed");return e?JSON.parse(e):[]}catch(e){return console.error("Error retrieving recently viewed products:",e),[]}}static createProductElement(e){const t=e.goods_item||{},n=e.random_item||{},c=n.item||{},o=e.price||0,i=e.price_volume||!1,r=document.createElement("div");r.className="recently-viewed__item",r.dataset.id=t.id,c.image;const a=c.item_article||t.article||"",s=this.createColorElements(e.colors||[]),l=n.price&&"0"!==n.price&&""!==n.price?n.price:o||"0";let d="";return e.item_list.forEach((t=>{const n=t.price&&"0"!==t.price&&""!==t.price?t.price:e.price||"0";t.item.id!=e.id_random?d+=`<img src="/static/viki_web_cms/files/item_photo/${t.item.image}" \n                      alt="${t.item.name||""}" \n                      class="item-hidden item-opaque"\n                      loading="lazy"\n                      data-id="${t.item.id}"\n                      data-article="${t.item.item_article||""}"\n                      data-price="${n}"\n                      data-color-description="${t.color_description||""}" />`:d+=`<img src="/static/viki_web_cms/files/item_photo/${t.item.image}" \n                      alt="${t.item.name||""}" \n                      data-id="${t.item.id}"\n                      data-article="${t.item.item_article||""}"\n                      data-price="${n}"\n                      data-color-description="${t.color_description||""}" />`})),r.innerHTML=`\n      <div class="recently-viewed__img">\n       <button class="recently-viewed__nav-button recently-viewed__nav-button--prev">\n          <i class="fa-solid fa-chevron-left"></i>\n       </button>\n       <button class="recently-viewed__nav-button recently-viewed__nav-button--next">\n          <i class="fa-solid fa-chevron-right"></i>\n       </button>\n       ${d}\n      </div>\n      <div class="recently-viewed__info">\n        <div class="recently-viewed__name">${t.name||""}</div>\n        <div class="recently-viewed__article" data-name="article">Артикул: ${a}</div>\n        <div class="recently-viewed__description" data-name="description">${n.color_description||""}</div>\n        <div class="recently-viewed__price" data-name="price">\n            <span>Цена${i?" от":""}:</span> ${l} руб.\n        </div>\n        <div class="recently-viewed__colors">\n          ${s}\n        </div>\n      </div>\n      <button class="recently-viewed__cart-btn btn btn__save">\n        <i class="fa-solid fa-cart-shopping"></i>&nbsp; В корзину\n      </button>\n      <a class="btn-hor"\n         href="/product/${t.slug}">\n         <button class="btn btn__cancel btn-sqr">\n            <div>Подробнее&nbsp;</div>\n            <i class="fa-solid fa-arrow-right"></i>\n        </button>\n      </a>\n    `,r}static createColorElements(e){return e&&0!==e.length?e.map((e=>{const t=e.main_color__hex||"#FFFFFF",n=e.main_color__name||"Цвет";return`\n        <div class="square square-small tooltip" \n             style="background-color: ${t};"  \n             data-id="${e.id}">\n          <span class="tooltip-text">${n}</span>\n        </div>\n      `})).join(""):""}static navigateRecentlyViewedImages(e,t){const n=Array.from(e.querySelectorAll(".recently-viewed__img img"));if(n.length<=1)return;const c=n.find((e=>!e.classList.contains("item-hidden")));if(!c)return;const o=n.indexOf(c);let i;i="prev"===t?o>0?o-1:n.length-1:o<n.length-1?o+1:0;const r=n[i];c.classList.add("item-hidden"),r.classList.remove("item-hidden","item-opaque");const a=r.dataset.id;e.querySelectorAll(".recently-viewed__colors .square").forEach((e=>{e.style.outline="none",e.style.outlineOffset="0",e.dataset.id===a&&(e.style.outline="1px solid #009EA3",e.style.outlineOffset="2px")}));const s=e.querySelector(".recently-viewed__article");s&&(s.textContent=`Артикул: ${r.dataset.article}`);const l=e.querySelector(".recently-viewed__price");if(l){const t=r.dataset.price||"0",n=e.querySelector(".recently-viewed__price span").textContent.includes("от");l.innerHTML=`<span>Цена${n?" от":""}:</span> ${t} руб.`}const d=e.querySelector(".recently-viewed__description");d&&(d.textContent=r.getAttribute("data-color-description")||"")}static initEventListeners(){document.querySelectorAll(".recently-viewed__colors .square").forEach((e=>{const t=e.closest(".recently-viewed__item"),n=[...t.querySelectorAll(".recently-viewed__img img")].find((e=>!e.classList.contains("item-hidden")));n&&t.querySelectorAll(`.square[data-id="${n.dataset.id}"]`).forEach((e=>{e.style.outline="1px solid #009EA3",e.style.outlineOffset="2px"})),e.addEventListener("click",(function(){const e=this.closest(".recently-viewed__item"),t=this.dataset.id,n=e.querySelectorAll(".recently-viewed__img img");e.querySelectorAll(".recently-viewed__colors .square").forEach((e=>{e.style.outline="none",e.style.outlineOffset="0"})),this.style.outline="1px solid #009EA3",this.style.outlineOffset="2px";const c=[...n].find((e=>!e.classList.contains("item-hidden")));if(!c)return;const o=[...n].find((e=>e.dataset.id===t));if(!o||c===o)return;c.classList.add("item-hidden"),o.classList.remove("item-hidden","item-opaque");const i=e.querySelector(".recently-viewed__article");i&&(i.textContent=`Артикул: ${o.dataset.article}`);const r=e.querySelector(".recently-viewed__price");if(r){const t=o.dataset.price||"0",n=e.querySelector(".recently-viewed__price span").textContent.includes("от");r.innerHTML=`<span>Цена${n?" от":""}:</span> ${t} руб.`}const a=e.querySelector(".recently-viewed__description");a&&(a.textContent=o.getAttribute("data-color-description")||"")}))}));const e=document.querySelectorAll(".recently-viewed__nav-button--prev"),t=document.querySelectorAll(".recently-viewed__nav-button--next");e.forEach((e=>{e.addEventListener("click",(function(){const e=this.closest(".recently-viewed__item");v.navigateRecentlyViewedImages(e,"prev")}))})),t.forEach((e=>{e.addEventListener("click",(function(){const e=this.closest(".recently-viewed__item");v.navigateRecentlyViewedImages(e,"next")}))})),document.querySelectorAll(".recently-viewed__cart-btn").forEach((e=>{e.addEventListener("click",(function(){const e=this.closest(".recently-viewed__item"),t=e.querySelector(".recently-viewed__name").textContent,n=e.querySelector(".recently-viewed__article").textContent.replace("Артикул: ",""),c=e.querySelector('.square[style*="outline: 1px solid"]');if(c){const e={name:t,article:n,color:c.querySelector(".tooltip-text").textContent};y.showAddToCartModal(e,(function(e){console.log(`Product "${e.name}" (${e.article}, color: ${e.color}) added to cart`),y.showSuccessMessage(e)}))}}))}))}}const f=v;async function h(){document.addEventListener("DOMContentLoaded",(async()=>{const e=document.querySelectorAll(".filter .product-header__filter-content_checkbox-hidden"),t=document.querySelectorAll(".products label.color-label"),n=document.querySelectorAll(".tab-btn"),c=document.querySelectorAll(".chev-next"),d=document.querySelector(".filter .input-range"),u=document.querySelector(".filter .btn__save"),m=document.querySelector(".filter .btn__cancel"),y=document.querySelectorAll(".filter input[type='checkbox']"),v=document.querySelectorAll(".btn-multicolor");e.forEach((e=>{e.addEventListener("change",(t=>{const n=document.querySelector(`label[for="${e.id}"]`).querySelector(".color-label__check");e.checked?n.style.display="block":n.removeAttribute("style")}))})),t.forEach((e=>{e.addEventListener("click",o)})),n.forEach((e=>{e.addEventListener("click",i)})),c.forEach((e=>{e.addEventListener("click",r)})),d.addEventListener("input",a),d.addEventListener("input",(e=>{p(y,d)})),m.addEventListener("click",s),u.addEventListener("click",await l),y.forEach((e=>{e.addEventListener("change",(e=>{p(y,d)}))})),v.forEach((e=>{e.addEventListener("click",_)})),document.querySelector(".recently-viewed__items")&&f.init()}))}}},i={};function r(e){var t=i[e];if(void 0!==t)return t.exports;var n=i[e]={exports:{}};return o[e](n,n.exports,r),n.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",c=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},r.a=(o,i,r)=>{var a;r&&((a=[]).d=-1);var s,l,d,u=new Set,m=o.exports,p=new Promise(((e,t)=>{d=t,l=e}));p[t]=m,p[e]=e=>(a&&e(a),u.forEach(e),p.catch((e=>{}))),o.exports=p,i((o=>{var i;s=(o=>o.map((o=>{if(null!==o&&"object"==typeof o){if(o[e])return o;if(o.then){var i=[];i.d=0,o.then((e=>{r[t]=e,c(i)}),(e=>{r[n]=e,c(i)}));var r={};return r[e]=e=>e(i),r}}var a={};return a[e]=e=>{},a[t]=o,a})))(o);var r=()=>s.map((e=>{if(e[n])throw e[n];return e[t]})),l=new Promise((t=>{(i=()=>t(r)).r=0;var n=e=>e!==a&&!u.has(e)&&(u.add(e),e&&!e.d&&(i.r++,e.push(i)));s.map((t=>t[e](n)))}));return i.r?l:r()}),(e=>(e?d(p[n]=e):l(m),c(a)))),a&&a.d<0&&(a.d=0)},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(342)})();